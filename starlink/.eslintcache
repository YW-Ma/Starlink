[{"F:\\OneDrive\\Developer\\Starlink\\Starlink\\starlink\\src\\index.js":"1","F:\\OneDrive\\Developer\\Starlink\\Starlink\\starlink\\src\\reportWebVitals.js":"2","F:\\OneDrive\\Developer\\Starlink\\Starlink\\starlink\\src\\components\\App.js":"3","F:\\OneDrive\\Developer\\Starlink\\Starlink\\starlink\\src\\components\\Header.js":"4","F:\\OneDrive\\Developer\\Starlink\\Starlink\\starlink\\src\\components\\Footer.js":"5","F:\\OneDrive\\Developer\\Starlink\\Starlink\\starlink\\src\\components\\Main.js":"6","F:\\OneDrive\\Developer\\Starlink\\Starlink\\starlink\\src\\components\\SatSetting.js":"7","F:\\OneDrive\\Developer\\Starlink\\Starlink\\starlink\\src\\components\\SatList.js":"8","F:\\OneDrive\\Developer\\Starlink\\Starlink\\starlink\\src\\constants.js":"9","F:\\OneDrive\\Developer\\Starlink\\Starlink\\starlink\\src\\components\\WorldMap.js":"10"},{"size":545,"mtime":1607572649952,"results":"11","hashOfConfig":"12"},{"size":362,"mtime":499162500000,"results":"13","hashOfConfig":"12"},{"size":268,"mtime":1608009698272,"results":"14","hashOfConfig":"12"},{"size":436,"mtime":1607583315082,"results":"15","hashOfConfig":"12"},{"size":280,"mtime":1607573266101,"results":"16","hashOfConfig":"12"},{"size":2947,"mtime":1608174940245,"results":"17","hashOfConfig":"12"},{"size":4102,"mtime":1607906558074,"results":"18","hashOfConfig":"12"},{"size":3934,"mtime":1608175039440,"results":"19","hashOfConfig":"12"},{"size":416,"mtime":1608175390818,"results":"20","hashOfConfig":"12"},{"size":8303,"mtime":1608182331831,"results":"21","hashOfConfig":"12"},{"filePath":"22","messages":"23","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"24"},"11fiz97",{"filePath":"25","messages":"26","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"24"},{"filePath":"27","messages":"28","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"24"},{"filePath":"29","messages":"30","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"24"},{"filePath":"31","messages":"32","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"24"},{"filePath":"33","messages":"34","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"24"},{"filePath":"35","messages":"36","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"24"},{"filePath":"37","messages":"38","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"39","usedDeprecatedRules":"24"},{"filePath":"40","messages":"41","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"24"},{"filePath":"42","messages":"43","errorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"44"},"F:\\OneDrive\\Developer\\Starlink\\Starlink\\starlink\\src\\index.js",[],["45","46"],"F:\\OneDrive\\Developer\\Starlink\\Starlink\\starlink\\src\\reportWebVitals.js",[],"F:\\OneDrive\\Developer\\Starlink\\Starlink\\starlink\\src\\components\\App.js",[],"F:\\OneDrive\\Developer\\Starlink\\Starlink\\starlink\\src\\components\\Header.js",[],"F:\\OneDrive\\Developer\\Starlink\\Starlink\\starlink\\src\\components\\Footer.js",[],"F:\\OneDrive\\Developer\\Starlink\\Starlink\\starlink\\src\\components\\Main.js",[],"F:\\OneDrive\\Developer\\Starlink\\Starlink\\starlink\\src\\components\\SatSetting.js",[],"F:\\OneDrive\\Developer\\Starlink\\Starlink\\starlink\\src\\components\\SatList.js",["47"],"import React, {Component} from 'react';\r\nimport { List, Avatar, Button, Checkbox, Spin } from \"antd\";\r\nimport satelliteLogo from \"../assets/images/satellite.svg\"\r\nimport {select} from \"d3-selection\"\r\n\r\n// 显示返回的数据 - List\r\n// 显示loading - main的state和修改\r\n// 通知map我选了什么 - 一个selected state。\r\n\r\n\r\nclass SatList extends Component {\r\n  constructor() {\r\n    super();\r\n    this.state = {\r\n      selected: [] //satList\r\n    };\r\n  }\r\n\r\n  render() {\r\n    const isLoading = this.props.isLoading;\r\n    // const satList = this.props.sateInfo.above; 不安全，sateInfo可能是undefined\r\n    const satList = this.props.sateInfo ? this.props.sateInfo.above : [];\r\n    return (\r\n      <div className=\"sat-list-box\">\r\n        <div className=\"sat-list-buttons\">\r\n          <Button\r\n            type=\"primary\"\r\n            className=\"sat-list-btn\"\r\n            size=\"large\"\r\n            onClick={this.onTrackOnMap}\r\n          >\r\n            Track on the map\r\n          </Button>\r\n          <Button\r\n            type=\"primary\"\r\n            className=\"sat-list-clear-btn\"\r\n            size=\"large\"\r\n            onClick={this.onClear}\r\n          >\r\n            Clear\r\n          </Button>\r\n        </div>\r\n        <hr />\r\n        {/*handle loading*/}\r\n        {\r\n          isLoading\r\n            ?\r\n            <div className=\"sat-loading\">\r\n              <Spin tip=\"Loading\" size=\"large\"></Spin>\r\n            </div>\r\n            :\r\n            <List\r\n              className=\"sat-list\"\r\n              itemLayout=\"horizontal\"\r\n              size=\"small\"\r\n              dataSource={satList}\r\n              renderItem={item => ( // this \"item\" stands for an entry of dataSource. (like an iterator)\r\n                <List.Item\r\n                  actions={[\r\n                    <Checkbox\r\n                      dataInfo={item}\r\n                      onChange={this.onChange}\r\n                      checked={this.state.selected.some( entry => entry.satid === item.satid )}\r\n                    />\r\n                  ]}\r\n                >\r\n                  <List.Item.Meta\r\n                    avatar={<Avatar size={50} src={satelliteLogo} />}\r\n                    title={<p>{item.satname}</p>}\r\n                    description={`Launch Date: ${item.launchDate}`}\r\n                  />\r\n                </List.Item>\r\n              )}\r\n            />\r\n        }\r\n      </div>\r\n    );\r\n  }\r\n  onChange = e => {\r\n    // step1: get current selected sat-info\r\n    const {dataInfo, checked} = e.target;\r\n    const {selected} = this.state;\r\n\r\n    // step2: add / remove current selected sat to / from a new selected list\r\n    const list = this.addOrRemove(dataInfo, checked, selected);\r\n    // step3: update selected state --> pass data to Main component to show it in Map\r\n    this.setState({\r\n      selected: list,\r\n    })\r\n  }\r\n\r\n  addOrRemove = (item, checked, list) => {\r\n    // case1: check is true:\r\n    //    1.1 item is not in the list -> add item\r\n    //    1.2 item is in the list -> do nothing\r\n\r\n    // case2: check is false:\r\n    //    2.1 item is not in the list -> do nothing\r\n    //    2.2 item is in the list -> remove item\r\n\r\n    // Tips:\r\n    // The some() method tests whether at least one element in the array\r\n    // passes the test implemented by the provided function.\r\n    // 删filter, 找m，加..\r\n    // It returns a Boolean value.\r\n    const found = list.some( entry => entry.satid === item.satid )\r\n    // 1.1\r\n    if (checked && !found) {\r\n      list = [...list, item];\r\n    }\r\n    // 2.2\r\n    if (!checked && found) {\r\n      list = list.filter(entry => {\r\n        return entry.satid !== item.satid;\r\n      });\r\n    }\r\n    return list;\r\n  }\r\n\r\n  onTrackOnMap = () => {\r\n    this.props.onShowMap(this.state.selected);\r\n  }\r\n\r\n  onClear = () => {\r\n    this.props.onClear();\r\n    this.setState(preState => ({\r\n      ...preState,\r\n      selected: []\r\n    }))\r\n  }\r\n}\r\n\r\nexport default SatList;\r\n","F:\\OneDrive\\Developer\\Starlink\\Starlink\\starlink\\src\\constants.js",[],"F:\\OneDrive\\Developer\\Starlink\\Starlink\\starlink\\src\\components\\WorldMap.js",["48","49","50"],"import React, { Component } from 'react';\r\nimport axios from 'axios';\r\nimport { Spin } from \"antd\"\r\n\r\nimport { feature } from \"topojson-client\"\r\nimport { geoKavrayskiy7 } from 'd3-geo-projection';\r\nimport { geoGraticule, geoPath } from 'd3-geo';\r\nimport { select as d3Select } from 'd3-selection';\r\nimport { timeFormat as d3TimeFormat } from \"d3-time-format\";\r\nimport { schemeCategory10 } from \"d3-scale-chromatic\";\r\nimport * as d3Scale from \"d3-scale\";\r\n\r\nimport {WORLD_MAP_URL, SATELLITE_POSITION_URL, SAT_API_KEY} from \"../constants\"\r\n\r\n\r\nconst width = 1024;\r\nconst height = 768;\r\n\r\nclass WorldMap extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      isLoading: false,\r\n      isDrawing: false\r\n    }\r\n    this.refMap = React.createRef();                                  // use ref to get a virtual node. So as we can draw on it.\r\n    this.refTrack = React.createRef();\r\n    this.map = null;\r\n    this.color = d3Scale.scaleOrdinal(schemeCategory10); // connect color and number\r\n  }\r\n\r\n  componentDidMount() {\r\n    axios.get(WORLD_MAP_URL)\r\n      .then( res => {\r\n        const { data } = res;                                         // retrieve the map data\r\n        const land = feature(data, data.objects.countries).features;  // land: border of 177 countries; topo: data, object: countries\r\n        this.generateMap(land);                                       // draw\r\n      })\r\n      .catch(e => console.error(\"err in fetch world map data\", e));\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState, snapshot) {\r\n    // determine whether prevProps and current props is different. Make a HTTPRequest only when props changed.\r\n    if(prevProps.satList !== this.props.satList) {\r\n      const {latitude, longitude, elevation, altitude, duration} = this.props.settings;\r\n      const endTime = duration * 60; // 1s in duration parameter equals to 60s in real world\r\n\r\n      this.setState({\r\n        isLoading: true\r\n      });\r\n\r\n      // step1: fetch data from API - a list of promise object\r\n      const urls = this.props.satList.map(sat => {\r\n        // Request: /positions/{id}/{observer_lat}/{observer_lng}/{observer_alt}/{seconds}//&apiKey={API_KEY}\r\n        const { satid } = sat;\r\n        const url = `/api/${SATELLITE_POSITION_URL}/${satid}/${latitude}/${longitude}/${altitude}/${endTime}/&apiKey=${SAT_API_KEY}`;\r\n        // send ajax call\r\n        return axios.get(url);\r\n      })\r\n\r\n      // step2: handle urls and extract results - Promise.all(...array...).then(results=>{})\r\n      Promise.all(urls)\r\n        .then(results => { // results are all returned promises from each axios.get(url)\r\n          this.setState({\r\n            isLoading: false,\r\n            isDrawing: true\r\n          });\r\n          if (!prevState.isDrawing) {\r\n            const data = results.map(item => item.data);\r\n            this.track(data);\r\n          } else {\r\n            const oHint = document.getElementsByClassName(\"hint\")[0];\r\n            oHint.innerHTML =\r\n              \"Please wait for these satellite animation to finish before selection new ones!\";\r\n          }\r\n        })\r\n        .catch(e => {\r\n          console.error(\"failed -> \", e);\r\n        });\r\n    }\r\n  }\r\n\r\n  // a callback used in componentDidUpdate - draw all satellites on the second canvas.\r\n  track = data => {\r\n    // validate the input\r\n    if (!data || !data[0].hasOwnProperty('positions')) {\r\n      throw new Error(\"no position data\", data);\r\n      return;\r\n    }\r\n\r\n    const len = data[0].positions.length;\r\n    const { duration } = this.props.settings;\r\n    const { context2 } = this.map;\r\n\r\n    // Step 1: draw time on the top\r\n    // current time\r\n    let initialTime = new Date();\r\n    let i = 0;\r\n    // interval between two drawing\r\n    let timer = setInterval(() => {\r\n      let currentTime = new Date();\r\n      let timePassed = i === 0 ? 0 : currentTime - initialTime;\r\n      // 1 sec in display == 1 minute in real world (corresponding to accelerated positions we got)\r\n      let time = new Date(initialTime.getTime() + 60 * timePassed);\r\n\r\n      context2.clearRect(0, 0, width, height); // clear the rect area.\r\n\r\n      context2.font = \"bold 20px sans-serif\";\r\n      context2.fillStyle = \"#333\";\r\n      context2.textAlign = \"center\";\r\n      context2.fillText(d3TimeFormat(time), width / 2, 20);\r\n\r\n      if (i >= len) {                   // timer cannot excced the length of positions array\r\n        clearInterval(timer);\r\n        this.setState({ isDrawing: false });\r\n        const oHint = document.getElementsByClassName(\"hint\")[0];\r\n        oHint.innerHTML = \"\";\r\n        return;\r\n      }\r\n\r\n      data.forEach(sat => {             // draw\r\n        const { info, positions } = sat;\r\n        this.drawSat(info, positions[i]);\r\n      });\r\n\r\n      i += 60;\r\n    }, 1000)\r\n\r\n  }\r\n\r\n  // a helper function used in track to draw each satellite\r\n  drawSat = (sat, pos) => {\r\n    const { satlongitude, satlatitude } = pos;\r\n    if (!satlongitude || !satlongitude) return;\r\n\r\n    const { satname } = sat;\r\n    const nameWithNumber = satname.match(/\\d+/g).join(\"\"); // extract satname number\r\n\r\n    const { projection, context2 } = this.map;\r\n    const xy = projection([satlongitude, satlatitude]); // get coordinate\r\n    context2.fillStyle = this.color(nameWithNumber); // name is a number\r\n    context2.beginPath();\r\n    context2.arc(xy[0], xy[1], 4, 0,2 * Math.PI); //radius, startAngle, endAngle\r\n    context2.fill();\r\n\r\n    context2.font = \"bold 11px sans-serif\";\r\n    context2.textAlign = \"center\";\r\n    context2.fillText(nameWithNumber, xy[0], xy[1] + 14);\r\n  }\r\n\r\n  // a callback used in componentDidMount - prepare 2 canvases' context & draw a world map on the first canvas\r\n  generateMap = land => {\r\n    const projection = geoKavrayskiy7()                            // Step 1: configure the projection method\r\n      .scale(180)\r\n      //.translate(width / 2, height / 2)                          // NOTICE: translate need an array\r\n      .translate([width / 2, height / 2])\r\n      .precision(.1);\r\n\r\n    const graticule = geoGraticule();                              // Step 2: get the longitude and latitude\r\n\r\n    const canvas = d3Select(this.refMap.current)                  // Step 3.1: let d3-selection get the canvas to draw world map\r\n      .attr(\"width\", width)\r\n      .attr(\"height\", height);\r\n\r\n    const canvas2 = d3Select(this.refTrack.current)               // Step 3.2: let d3 get the canvas to draw the satellite\r\n      .attr(\"width\", width)\r\n      .attr(\"height\", height);\r\n\r\n    const context = canvas.node().getContext(\"2d\");       // path can convert realworld data to context using projection\r\n    const context2 = canvas2.node().getContext(\"2d\");\r\n\r\n    let path = geoPath().projection(projection).context(context);\r\n\r\n    land.forEach( ele => {                                        // Step 4.1 : draw countries' border\r\n      context.fillStyle = '#B3DDEF';\r\n      context.strokeStyle = '#000';\r\n      context.globalAlpha = 0.7;\r\n      context.beginPath();\r\n      path(ele);            // draw the border of a country\r\n      context.fill();       // fill the country\r\n      context.stroke();\r\n    })\r\n\r\n    context.strokeStyle = 'rgba(220, 220, 220, 0.5)';           //Step 4.2: draw longitude and latitude\r\n    context.beginPath();\r\n    path(graticule());\r\n    context.lineWidth = 1;\r\n    context.stroke();\r\n\r\n    context.beginPath();                                        //Step 4.3: draw head and bottom\r\n    context.lineWidth = 1;\r\n    path(graticule.outline());\r\n    context.stroke();\r\n\r\n    this.map = {                                                //Step 5: store map in a field. they don't update UI so\r\n      context: context,                                          //       there is no need to store them in a state\r\n      context2: context2,\r\n      projection: projection\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const { isLoading } = this.state;\r\n    return (\r\n      <div className=\"map-box\">\r\n        {isLoading ? (\r\n          <div className=\"spinner\">\r\n            <Spin tip=\"Loading...\" size=\"large\" />\r\n          </div>\r\n        ) : null}\r\n        <canvas className=\"map\" ref={this.refMap}/>\r\n        <canvas className=\"track\" ref={this.refTrack}/>\r\n        <div className=\"hint\" />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default WorldMap;\r\n",{"ruleId":"51","replacedBy":"52"},{"ruleId":"53","replacedBy":"54"},{"ruleId":"55","severity":1,"message":"56","line":4,"column":9,"nodeType":"57","messageId":"58","endLine":4,"endColumn":15},{"ruleId":"55","severity":1,"message":"59","line":45,"column":35,"nodeType":"57","messageId":"58","endLine":45,"endColumn":44},{"ruleId":"60","severity":1,"message":"61","line":88,"column":7,"nodeType":"62","messageId":"63","endLine":88,"endColumn":14},{"ruleId":"55","severity":1,"message":"64","line":92,"column":13,"nodeType":"57","messageId":"58","endLine":92,"endColumn":21},"no-native-reassign",["65"],"no-negated-in-lhs",["66"],"no-unused-vars","'select' is defined but never used.","Identifier","unusedVar","'elevation' is assigned a value but never used.","no-unreachable","Unreachable code.","ReturnStatement","unreachableCode","'duration' is assigned a value but never used.","no-global-assign","no-unsafe-negation"]